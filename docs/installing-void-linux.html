<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Installing Void Linux</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="I made the switch to void linux. Except for compatibility issues around glibc, it works quite well. Most compatibility I have worked around with a..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">0ink.net</a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/privacy-policy.html">Privacy Policy</a></li>
                    <li class="active"><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/installing-void-linux.html" rel="bookmark"
           title="Permalink to Installing Void Linux">Installing Void Linux</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-02-19T00:00:00+01:00">
                Published: Tue 19 February 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>

</footer><!-- /.post-info -->      <p>I made the switch to <a href="https://voidlinux.org" title="Void Linux">void linux</a>.  Except for compatibility
issues around <code>glibc</code>, it works quite well.  Most compatibility
I have worked around with a combination of <code>Flatpak</code>s, <code>chroot</code>s and
<code>namespaces</code>.</p>
<p>The high lights of <a href="https://voidlinux.org" title="Void Linux">void linux</a>:</p>
<ul>
<li>musl build - which is very lightweigth</li>
<li>Does not depend on <code>systemd</code></li>
<li>a reasonable selection of software packages</li>
</ul>
<p>I have tweaked the installation on my computers to use UEFI and thus
I am using <a href="http://www.rodsbooks.com/refind/" title="rEFInd bootloader">rEFInd</a> instead of grub.  This is because it makes
doing bare metal backups and restore just a simple file copy.</p>
<p>My installation process roughly follows the <a href="https://wiki.voidlinux.org/Installation_on_UEFI,_via_chroot" title="Install void linux on UEFI via chroot">UEFI chroot install</a>.</p>
<p>This process is implemented in a script and can be found here:</p>
<ul>
<li><a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/install.sh">install.sh</a></li>
</ul>
<p>Script usage:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">Usage</span><span class="err">:</span><span class="w"> </span><span class="n">installer</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="n">_</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdx_</span><span class="w"> </span><span class="n">_hostname_</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"></span>

<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nl">_sdx_</span><span class="p">:</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ow">or</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="nc">image</span><span class="o">=</span><span class="n">filepath</span><span class="o">[</span><span class="n">:size</span><span class="o">]</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">disc</span><span class="w"> </span><span class="nc">image</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="n">imgset</span><span class="o">=</span><span class="n">filebase</span><span class="o">[</span><span class="n">:size</span><span class="o">]</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="nc">image</span><span class="w"> </span><span class="k">set</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="n">dirpath</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nl">_hostname_</span><span class="p">:</span><span class="w"> </span><span class="n">Hostname</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">use</span><span class="w"></span>

<span class="w">    </span><span class="nl">Options</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">swap</span><span class="o">=</span><span class="n">kbs</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">swap</span><span class="w"> </span><span class="k">size</span><span class="p">,</span><span class="w"> </span><span class="n">defaults</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="p">,</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">numfmt</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nf">parse</span><span class="w"> </span><span class="k">values</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">glibc</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">glibc</span><span class="w"> </span><span class="n">install</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">noxwin</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">insall</span><span class="w"> </span><span class="n">X11</span><span class="w"> </span><span class="n">related</span><span class="w"> </span><span class="n">packages</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">nodesktop</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">desktop</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">desktop</span><span class="o">=</span><span class="n">mate</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">MATE</span><span class="w"> </span><span class="n">dekstop</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">passwd</span><span class="o">=</span><span class="n">password</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="p">(</span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">enc</span><span class="o">-</span><span class="n">passwd</span><span class="o">=</span><span class="n">encrypted</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">encrypted</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">ovl</span><span class="o">=</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">tarball</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">files</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">post</span><span class="o">=</span><span class="n">script</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">script</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">pkgs</span><span class="o">=</span><span class="k">file</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">text</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">software</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">install</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">bios</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">BIOS</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="p">(</span><span class="n">needs</span><span class="w"> </span><span class="n">syslinux</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="k">path</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">cache</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">xen</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">xen</span><span class="w"> </span><span class="k">specific</span><span class="w"> </span><span class="n">tweaks</span><span class="w"></span>
</code></pre></div>

<h3>Command line examples</h3>
<ul>
<li>sudo sh install.sh --dir=$HOME/vx9 vx9 swap=4G glibc passwd=1234567890 cache=$HOME/void-cache xen</li>
<li>sudo sh install.sh --dir=$HOME/vx1 vx1 swap=4G glibc passwd=1234567890 cache=$HOME/void-cache xen</li>
<li>sudo sh install.sh --dir=$HOME/vx11 vx11 swap=4G       passwd=1234567890 cache=$HOME/void-cache xen</li>
</ul>
<h2>Initial set-up</h2>
<p>Boot using the void live CD and partition the target disk:</p>
<div class="highlight"><pre><span></span><code>cfdisk -z /dev/xda
</code></pre></div>

<p>Make sure you use <code>gpt</code> label type (for UEFI boot).  I am creating
the following partitions:</p>
<ol>
<li>500MB <code>EFI System</code></li>
<li><em>RAM Size * 1.5</em> <code>Linux swap</code>, Mainly used for Hibernate.</li>
<li><em>Rest of drive</em> <code>Linux filesystem</code>, Root file system</li>
</ol>
<p>This is on a USB thumb drive.  The data I keep on an internal disk.</p>
<p>Now we create the filesystems:</p>
<div class="highlight"><pre><span></span><code>mkfs.vfat -F 32 -n EFI /dev/xda1
mkswap -L swp0 /dev/xda2
mkfs.xfs -f -L voidlinux /dev/xda3
</code></pre></div>

<p>We're now ready to mount the volumes, making any necessary mount point directories along the way (the sequence is important, yes):</p>
<div class="highlight"><pre><span></span><code>mount /dev/xda3 /mnt
mkdir /mnt/boot
mount /dev/xda1 /mnt/boot
</code></pre></div>

<h2>Installing Void</h2>
<p>So we do a targeted install:</p>
<p>For musl-libc</p>
<div class="highlight"><pre><span></span><code>env XBPS_ARCH=x86_64-musl xbps-install -S -R http://alpha.de.repo.voidlinux.org/current/musl -r /mnt base-system grub-x86_64-efi
</code></pre></div>

<p>For glibc</p>
<div class="highlight"><pre><span></span><code>env XBPS_ARCH=x86_64 xbps-install -S -R http://alpha.de.repo.voidlinux.org/current -r /mnt base-system grub-x86_64-efi
</code></pre></div>

<p>But actually, for the package list I have been using these lists:</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist.txt"></script>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist-xwin.txt?footer=minimal"></script>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist-mate.txt?footer=minimal"></script>

<p>This installs a <a href="https://mate-desktop.org/" title="MATE Desktop environment">MATE</a> desktop environment.</p>
<h3>Software selection notes</h3>
<ul>
<li>For time synchronisation (ntp) we ae choosing <code>chrony</code> as it is
  reputed to be more secure that <code>ntpd</code> and more compliant than
  <code>openntpd</code>.</li>
<li>We are using the default configuration, which should be OK.  Uses
  <code>pool.ntp.org</code> for the time server which would use a suitable
  default.</li>
<li>For <code>cron</code> we are using <code>dcron</code>.  It is full featured (i.e.
  compatibnle with <code>cron</code> and it can handle power-off situations,
  while being the most light-weight option available.
  See: <a href="https://voidlinux.org/faq/#cron">VoidLinux FAQ: Cron</a></li>
<li>Includes <code>autofs</code> and <code>nfs-utils</code> for network filesystems and
  automount support.</li>
</ul>
<h2>nonfree software and other repositories</h2>
<p>Additional repositories are available to support either
non-free software and in the case of glibc, multilib (32 bit)
binaries.</p>
<p>To enable under the musl version:</p>
<div class="highlight"><pre><span></span><code>env XBPS_ARCH=&quot;$arch&quot; xbps-install -y -S -R &quot;$voidurl&quot; -r /mnt void-repo-nonfree
</code></pre></div>

<p>For glibc:</p>
<div class="highlight"><pre><span></span><code>env XBPS_ARCH=&quot;$arch&quot; xbps-install -y -S -R &quot;$voidurl&quot; -r /mnt void-repo-nonfree void-repo-multilib void-repo-multilib-nonfree
</code></pre></div>

<p>Then you can install non-free software.</p>
<h2>Enter the void chroot</h2>
<p>Upon completion of the install, we set up our chroot jail, and chroot into our mounted filesystem:</p>
<div class="highlight"><pre><span></span><code>mount -t proc proc /mnt/proc
mount -t sysfs sys /mnt/sys
mount -o bind /dev /mnt/dev
mount -t devpts pts /mnt/dev/pts
cp -L /etc/resolv.conf /mnt/etc/
chroot /mnt bash -il
</code></pre></div>

<p>In order to verify our install, we can have a look at the directory structure:</p>
<div class="highlight"><pre><span></span><code> ls -la
</code></pre></div>

<p>The output should look something akin to the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">16</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">16</span> <span class="o">..</span>
<span class="n">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">7</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">bin</span> <span class="o">-&gt;</span> <span class="n">usr</span><span class="o">/</span><span class="n">bin</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">4</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">127</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">37</span> <span class="n">boot</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">17</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">dev</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">26</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span> <span class="n">etc</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">home</span>
<span class="n">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">7</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">lib</span> <span class="o">-&gt;</span> <span class="n">usr</span><span class="o">/</span><span class="n">lib</span>
<span class="n">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">9</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">lib32</span> <span class="o">-&gt;</span> <span class="n">usr</span><span class="o">/</span><span class="n">lib32</span>
<span class="n">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">7</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">lib64</span> <span class="o">-&gt;</span> <span class="n">usr</span><span class="o">/</span><span class="n">lib</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">media</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">mnt</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">opt</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">proc</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">26</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">39</span> <span class="n">root</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">17</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">run</span>
<span class="n">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">8</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">sbin</span> <span class="o">-&gt;</span> <span class="n">usr</span><span class="o">/</span><span class="n">sbin</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">sys</span>
<span class="n">drwxrwxrwt</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>    <span class="mi">6</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">15</span> <span class="n">tmp</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">11</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">123</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="n">usr</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">11</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">150</span> <span class="n">Jan</span> <span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span> <span class="k">var</span>
</code></pre></div>

<p>While chrooted, we create the password for the root user, and set root access permissions:</p>
<div class="highlight"><pre><span></span><code> passwd root
 chown root:root /
 chmod 755 /
</code></pre></div>

<p>Since I am a <code>bash</code> convert, I would do this:</p>
<div class="highlight"><pre><span></span><code> xbps-alternatives --set bash
</code></pre></div>

<p>Create the <code>hostname</code> for the new install:</p>
<div class="highlight"><pre><span></span><code>echo &lt;HOSTNAME&gt; &gt; /etc/hostname
</code></pre></div>

<p>Edit our <code>/etc/rc.conf</code> file, like so:</p>
<div class="highlight"><pre><span></span><code><span class="n">HOSTNAME</span><span class="o">=</span><span class="s2">&quot;&lt;HOSTNAME&gt;&quot;</span>

<span class="c1"># Set RTC to UTC or localtime.</span>
<span class="n">HARDWARECLOCK</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span>

<span class="c1"># Set timezone, availables timezones at /usr/share/zoneinfo.</span>
<span class="n">TIMEZONE</span><span class="o">=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span>

<span class="c1"># Keymap to load, see loadkeys(8).</span>
<span class="n">KEYMAP</span><span class="o">=</span><span class="s2">&quot;us-acentos&quot;</span>

<span class="c1"># Console font to load, see setfont(8).</span>
<span class="c1">#FONT=&quot;lat9w-16&quot;</span>

<span class="c1"># Console map to load, see setfont(8).</span>
<span class="c1">#FONT_MAP=</span>

<span class="c1"># Font unimap to load, see setfont(8).</span>
<span class="c1">#FONT_UNIMAP=</span>

<span class="c1"># Kernel modules to load, delimited by blanks.</span>
<span class="c1">#MODULES=&quot;&quot;</span>
</code></pre></div>

<p>Also, modify the <code>/etc/fstab</code>:</p>
<div class="highlight"><pre><span></span><code>#
# See fstab(5).

# &lt;file system&gt; &lt;dir&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
tmpfs       /tmp    tmpfs   defaults,nosuid,nodev   0       0
LABEL=EFI   /boot   vfat    rw,fmask=0133,dmask=0022,noatime,discard  0 2
LABEL=voidlinux /   xfs rw,relatime,discard 0 1
LABEL=swp0  swap    swap    defaults        0 0
</code></pre></div>

<p>For a removable drive I include the line:</p>
<div class="highlight"><pre><span></span><code>LABEL=volume    /media/blahblah xfs rw,relatime,nofail 0 0
</code></pre></div>

<p>The important setting here is <strong>nofail</strong>.  When the drive is
available it gets mounted.  If not, the <strong>nofail</strong> prevents
this to cause the boot sequence to stop.</p>
<p>If using <code>glibc</code> you can modify <code>/etc/default/libc-locales</code> and
uncomment:</p>
<p><code>en_US.UTF-8 UTF-8</code></p>
<p>Or whatever locale you want to use.  And run:</p>
<div class="highlight"><pre><span></span><code> xbps-reconfigure -f glibc-locales
</code></pre></div>

<h2>Set-up UEFI boot</h2>
<p>Download the <a href="http://www.rodsbooks.com/refind/" title="rEFInd bootloader">rEFInd</a> zip binary from:</p>
<ul>
<li><a href="http://www.rodsbooks.com/refind/getting.html" title="rEFInd download page">rEFInd download</a></li>
</ul>
<p>Set-up the boot partition:</p>
<div class="highlight"><pre><span></span><code>mkdir /boot/EFI
mkdir /boot/EFI/BOOT
</code></pre></div>

<p>Copy from the <code>zip file</code> the file <code>refind-bin-{version}/refind/refind_x64.efi</code> to
<code>/boot/EFI/BOOT/BOOTX64.EFI</code>.</p>
<p>The version I am using right now can be found here: <a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/BOOTX64.EFI">v0.11.4 BOOTX64.EFI</a></p>
<p>Create kernel options files <code>/boot/cmdline</code>:</p>
<div class="highlight"><pre><span></span><code>root=LABEL=voidlinux ro quiet
</code></pre></div>

<p>For my hardware I had to add the option:</p>
<ul>
<li><code>intel_iommu=igfx_off</code></li>
<li>To work around some strange bug.</li>
<li><code>i915.enable_ips=0</code></li>
<li>fixes a power saving mode problem on 4.1-rc6+</li>
</ul>
<p>Create the following script as <code>/boot/mkmenu.sh</code></p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/mkmenu.sh"></script>

<p>Add the following scripts to:</p>
<ul>
<li><code>/etc/kernel.d/post-install/99-refind</code></li>
<li><code>/etc/kernel.d/post-remove/99-refind</code></li>
</ul>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/hook.sh"></script>

<p>Make sure they are executable.  This is supposed to re-create
menu entries whenever the kernel gets upgraded.</p>
<p>We need to have a look at <code>/lib/modules</code> to get our Linux kernel version</p>
<div class="highlight"><pre><span></span><code>ls -la /lib/modules
</code></pre></div>

<p>Which should return something akin to:</p>
<div class="highlight"><pre><span></span><code>drwxr-xr-x  3 root root   21 Jan 31 15:22 .
drwxr-xr-x 23 root root 8192 Jan 31 15:22 ..
drwxr-xr-x  3 root root 4096 Jan 31 15:22 5.2.13_1
</code></pre></div>

<p>And this script to create boot files:</p>
<div class="highlight"><pre><span></span><code>xbps-reconfigure -f linux5.2
</code></pre></div>

<p>If you need to manually prepare boot files:</p>
<div class="highlight"><pre><span></span><code># update dracut
dracut --force --kver 4.19.4_1
# update refind menu
bash /boot/mkmenu.sh
</code></pre></div>

<p>We are now ready to boot into <a href="https://voidlinux.org" title="Void Linux">Void</a>.</p>
<div class="highlight"><pre><span></span><code><span class="k">exit</span>
<span class="nv">umount</span> <span class="o">-</span><span class="nv">R</span> <span class="o">/</span><span class="nv">mnt</span>
<span class="nv">reboot</span>
</code></pre></div>

<h2>Post install</h2>
<p>After the first boot, we need to activate services:</p>
<p>Command line set-up:</p>
<div class="highlight"><pre><span></span><code><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="n">dhcpcd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="n">sshd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="p">{</span><span class="n">acpid</span><span class="p">,</span><span class="n">chronyd</span><span class="p">,</span><span class="n">cgmanager</span><span class="p">,</span><span class="n">crond</span><span class="p">,</span><span class="n">uuidd</span><span class="p">,</span><span class="n">statd</span><span class="p">,</span><span class="n">rcpbind</span><span class="p">,</span><span class="n">autofs</span><span class="p">}</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
</code></pre></div>

<p>Full workstation set-up:</p>
<div class="highlight"><pre><span></span><code><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="n">dbus</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="n">NetworkManager</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="n">sshd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="p">{</span><span class="n">acpid</span><span class="p">,</span><span class="n">chronyd</span><span class="p">,</span><span class="n">cgmanager</span><span class="p">,</span><span class="n">crond</span><span class="p">,</span><span class="n">uuidd</span><span class="p">,</span><span class="n">statd</span><span class="p">,</span><span class="n">rcpbind</span><span class="p">,</span><span class="n">autofs</span><span class="p">}</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sv</span><span class="o">/</span><span class="p">{</span><span class="n">consolekit</span><span class="p">,</span><span class="n">lxdm</span><span class="p">}</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">service</span>
</code></pre></div>

<p>Creating new users:</p>
<div class="highlight"><pre><span></span><code>useradd -m -s /bin/bash -U -G wheel,users,audio,video,cdrom,input newuser
passwd newuser
</code></pre></div>

<p>Note: The <code>wheel</code> user group allows the user to escalate to root.</p>
<p>Configure sudo:</p>
<div class="highlight"><pre><span></span><code>visudo
</code></pre></div>

<p>Uncomment:</p>
<div class="highlight"><pre><span></span><code># %wheel ALL=(ALL) ALL
</code></pre></div>

<h2>Configure keyboard</h2>
<p>Create configuration file: <code>/etc/X11/xorg.conf.d/30-keyboard.conf</code></p>
<div class="highlight"><pre><span></span><code>Section &quot;InputClass&quot;
    Identifier &quot;keyboard-all&quot;
    Option &quot;XkbLayout&quot; &quot;us&quot;
    # Option &quot;XkbModel&quot; &quot;pc105&quot;
    # Option &quot;XkbVariant&quot; &quot;altgr-intl&quot;
    Option &quot;XkbVariant&quot; &quot;intl&quot;
    # MatchIsKeyboard &quot;on&quot;
EndSection
</code></pre></div>

<p>This makes the <code>intl</code> for the <code>XkbVariant</code> the system-wide default.</p>
<p>Since, as a programmer I prefer the <code>altgr-intl</code> variant, then I
run this in my de desktop environment startup to override the
default:</p>
<div class="highlight"><pre><span></span><code><span class="n">setxkbmap</span> <span class="o">-</span><span class="n">rules</span> <span class="n">evdev</span> <span class="o">-</span><span class="n">model</span> <span class="n">evdev</span> <span class="o">-</span><span class="n">layout</span> <span class="n">us</span> <span class="o">-</span><span class="n">variant</span> <span class="n">altgr</span><span class="o">-</span><span class="n">intl</span>
</code></pre></div>

<h2>Using SLIM</h2>
<p>I have switched to <a href="https://github.com/iwamatsu/slim" title="Simple Login Manager">SLiM</a> as the display manager.  This is
configured in <code>/etc/slim.conf</code>.</p>
<p>Specifically, I update the login_cmd to be the following:</p>
<div class="highlight"><pre><span></span><code><span class="nv">login_cmd</span> <span class="k">exec</span> <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">sh</span> <span class="o">-</span><span class="nv">l</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">X11</span><span class="o">/</span><span class="nv">Xsession</span> <span class="o">%</span><span class="nv">session</span>
</code></pre></div>

<p>And have a custom <a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/Xsession">Xsession</a> script.</p>
<h2>Tweaks and Bug-fixes</h2>
<h3>/etc/machine-id or /var/lib/dbus/machine-id</h3>
<p>Because we don't use <code>systemd</code>, we need to create <code>/etc/machine-id</code>
and <code>/var/lib/dbus/machine-id</code>.
manually.  This is only needed for desktop systems.</p>
<p>See [this article][machineid] for more
info.</p>
<div class="highlight"><pre><span></span><code>  <span class="n">dbus</span><span class="o">-</span><span class="n">uuidgen</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">id</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dbus</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">id</span>
</code></pre></div>

<h3>power button handling</h3>
<p>This patch prevents the /etc/acpi/handler.sh to handle the power button
instead, letting the Desktop Environment handle the event.</p>
<p>It does it by checking if the Desktop Environment power manager
(in this case <code>mate-power-manager</code>) is running.  If it is, then
it will exit.</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/acpi-handler.patch"></script>

<h3>rtkit spamming logs</h3>
<p>Apparently, <code>rtkit</code> requres an <code>rtkit</code> user to exist.  Otherwise it
will spam the logs with error messages.  To correct use this command:</p>
<div class="highlight"><pre><span></span><code>useradd -r -s /sbin/nologin rtkit
</code></pre></div>

<h3>xen tweaks</h3>
<p>For xen we need to make some adjustments...</p>
<ol>
<li>Tweak block device references.</li>
<li><code>/etc/fstab</code> : mount xvda and other devices</li>
<li><code>/boot/cmdline</code> : get the right xvda root device</li>
<li>Enable disable services</li>
<li>Disable: <code>slim</code>, <code>agetty-ttyX</code></li>
<li>Enable: <code>agetty-hvc0</code></li>
<li>Decide if you want to use <code>NetworkManager</code> or <code>dhcpcd</code>.</li>
</ol>
<p>Normally, I would create a tarball image to transfer over, in order
for the image to work properly you need to save <code>capabilities</code>.</p>
<h2>Old Notes</h2>
<h3>PolKit rule tweaks</h3>
<p>Testing as of 2019-09-07, the following does not seem to be needed
any longer.  I left it here just for reference (in case it breaks
again.</p>
<hr>
<p>OK, in my case, <code>shutdown</code>, <code>reboot</code> and local media access functions
were not available using the <a href="https://mate-desktop.org/" title="MATE Desktop environment">MATE</a> desktop.</p>
<p>To enable this I had to create/tweak the PolKit rules...</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/_attic_/tweak-polkit-rules.sh"></script>

<hr>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://www.iliu.net">Familia</a></li>
                            <li><a href="https://github.com/alejandroliu/0ink.net">github</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>