<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>ArchLinux tips</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="A bunch of recipes useful for an ArchLinux system environment. Mostly around system administration. Custom Repos and Packages In the repo..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">0ink.net</a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/privacy-policy.html">Privacy Policy</a></li>
                    <li class="active"><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/archlinux-tips.html" rel="bookmark"
           title="Permalink to ArchLinux tips">ArchLinux tips</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-05-27T00:00:00+02:00">
                Published: Mon 27 May 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>

</footer><!-- /.post-info -->      <p>A bunch of recipes useful for an ArchLinux system environment.</p>
<p>Mostly around system administration.</p>
<h1>Custom Repos and Packages</h1>
<p>In the repo directory, put all the packages in there.</p>
<div class="highlight"><pre><span></span><code>repo-add ./custom.db.tar.gz ./*
</code></pre></div>

<p>Add to <code>pacman.conf</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[custom]</span>
<span class="na">SigLevel</span> <span class="o">=</span> <span class="s">[Package|Databse]Never|Optional|Required</span>
<span class="na">Server</span> <span class="o">=</span> <span class="s">path-to-repo</span>
</code></pre></div>

<p>See also <code>repo-remove</code>. A package database is a tar file, optionally compressed. Valid extensions are <code>.db</code> or <code>.files</code> followed by an archive extension of <code>.tar</code>, <code>.tar.gz</code>, <code>.tar.bz2</code>, <code>.tar.xz</code>, or <code>.tar.Z</code>. The file does not need to exist, but all parent directories must exist. ?Can we create a <code>rpmgot.php</code> hack?</p>
<h1>Safe automatic pacman upgrades</h1>
<ul>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=66822">safepac</a> : This is an approach for automating pacman upgrades yet catching <em>problematic</em> updates before hand.</li>
</ul>
<h1>Building packages</h1>
<p>requires: @base-devel, abs, fakeroot</p>
<div class="highlight"><pre><span></span><code>makepkg -s 
</code></pre></div>

<p>or</p>
<div class="highlight"><pre><span></span><code>makeworld ?
</code></pre></div>

<h1>Working with the serial console</h1>
<p>Configure your Arch Linux machine so you can connect to it via the serial console port (com port). This will enable you to administer the machine even if it has no keyboard, mouse, monitor, or network attached to it (a headless server).</p>
<h2>Configuration</h2>
<p>Add this to the bootloader kernel line:</p>
<div class="highlight"><pre><span></span><code>console=tty0 console=ttyS0,9600
</code></pre></div>

<p>From systemd:</p>
<div class="highlight"><pre><span></span><code><span class="n">systemctl</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">getty</span><span class="nv">@ttyS0</span><span class="p">.</span><span class="n">service</span><span class="w"> </span>
</code></pre></div>

<h1>Installing Arch Linux using the serial console</h1>
<ol>
<li>Boot the target machine using the Arch Linux installation CD.</li>
<li>When the bootloader appears, select "Boot Arch Linux ()" and press tab to edit</li>
<li>Append console=ttyS0 and press enter</li>
<li>Systemd should now detect ttyS0 and spawn a serial getty on it, allowing you to proceed as usual</li>
</ol>
<p>Note: After setup is complete, the console settings will not be saved on the target machine; in order to avoid having to connect a keyboard and monitor, configure console access on the target machine before rebooting.</p>
<hr>
<h1>Identifying files not owned by any package</h1>
<div class="highlight"><pre><span></span><code>pacman-disowned

#!/bin/sh

tmp=<span class="cp">${</span><span class="n">TMPDIR</span><span class="o">-/</span><span class="n">tmp</span><span class="cp">}</span>/pacman-disowned-<span class="nv">$UID</span>-$$
db=<span class="nv">$tmp</span>/db
fs=<span class="nv">$tmp</span>/fs

mkdir &quot;<span class="nv">$tmp</span>&quot;
trap &#39;rm -rf &quot;<span class="nv">$tmp</span>&quot;&#39; EXIT

pacman -Qlq | sort -u &gt; &quot;<span class="nv">$db</span>&quot;

find /bin /etc /sbin /usr 
  ! -name lost+found 
  ( -type d -printf &#39;%p/n&#39; -o -print ) | sort &gt; &quot;<span class="nv">$fs</span>&quot;

comm -23 &quot;<span class="nv">$fs</span>&quot; &quot;<span class="nv">$db</span>&quot;
</code></pre></div>

<h1>Pacman one liners</h1>
<ul>
<li>
<p>Remove packages and its dependancies. pacman -Rs ...</p>
</li>
<li>
<p>List explicitly installed packages pacman -Qeq</p>
</li>
<li>
<p>List orphans pacman -Qtdq</p>
</li>
<li>
<p>Remove everything but base group pacman -Rs $(comm -23 &lt;(pacman -Qeq|sort) &lt;((for i in $(pacman -Qqg base); do pactree -ul $i; done)|sort -u|cut -d ' ' -f 1))</p>
</li>
<li>
<p>Listing changed configuraiton files pacman -Qii | awk '/^MODIFIED/ {print $2}'</p>
</li>
<li>
<p>Download a package without installing it pacman -Sw package_name</p>
</li>
<li>
<p>Manage pacman cache</p>
<p>paccache -h</p>
</li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://www.iliu.net">Familia</a></li>
                            <li><a href="https://github.com/alejandroliu/0ink.net">github</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>