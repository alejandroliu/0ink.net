<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>File system encryption in Alpine Linux - 0ink.net</title>
	<meta name="author" content="Alejandro Liu">


	<meta name="description" content="service This is similar to my previous article [[../2019/2019-02-28-encrypting-fs-in-void.md|Encrypting Filesystem in Void Linux]] but for Alpine Linux The point of this recipe is to create a encrypted file sytem so that when the disc is disposed, it does not need to be securely erased. This is particularly …">
	<meta name="int-title" content="File system encryption in Alpine Linux">
	<meta name="tags" content="alpine, boot, configuration, device, encryption, filesystem, idea, linux, service">
	<meta name="date" content="2023-09-15 00:00:00+02:00">
	<meta name="modified" content="2023-05-18 09:46:47+02:00">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />


    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="0ink.net Atom Feed" />
    <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="0ink.net RSS Feed" />
</head>

<body>
    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	        <a href="/feeds/atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed" title="atom feed"/></a>
	    </div>
		<nav class="pages">
			    <a href="/pages/about.html">About</a>
-			    <a href="/pages/privacy-policy.html">Privacy Policy</a>
		</nav>
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		0ink.net</a>
	      <div class="logo">
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		  <img src="/images/2021/0ink.png" width="44" height="44" />
		</a>
	      </div>



      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
			<iframe src="https://duckduckgo.com/search.html?site=0ink.net&prefill=Search with DuckDuckGo" style="overflow:hidden;margin:5px;padding:0;width:408px;height:40px;" frameborder="0"></iframe>

	<article class="full">

		<h1>File system encryption in Alpine Linux</h1>

<div class="metadata">
  <time datetime="2023-09-15T00:00:00+02:00" pubdate>Fri 15 September 2023</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
    </address>
  <p>Updated: 2023-05-18 09:46:47+02:00</p>
  in <a href="/category/c2023.html">2023</a>
<p class="tags">tagged <a href="/tag/alpine.html">alpine</a>, <a href="/tag/boot.html">boot</a>, <a href="/tag/configuration.html">configuration</a>, <a href="/tag/device.html">device</a>, <a href="/tag/encryption.html">encryption</a>, <a href="/tag/filesystem.html">filesystem</a>, <a href="/tag/idea.html">idea</a>, <a href="/tag/linux.html">linux</a>, <a href="/tag/service.html">service</a></p></div>
		<h3 id="service">service</h3>
<p>This is similar to my previous article
[[../2019/2019-02-28-encrypting-fs-in-void.md|Encrypting Filesystem in Void Linux]]
but for Alpine Linux</p>
<p>The point of this recipe is to create a encrypted file sytem
so that when the disc is disposed, it does not need to be
securely erased.  This is particularly important for SSD devices
since because of block remapping (for wear levelling) data can't
be overwritten consistently.</p>
<p>The idea is that the boot/root filesystem containing the encryption
keys are stored in a different device as the encrypted file system.</p>
<h2 id="create-block-devices">Create block devices</h2>
<div class="highlight"><pre><span></span><code><span class="nv">apk</span><span class="w"> </span><span class="nv">add</span><span class="w"> </span><span class="nv">lvm2</span><span class="w"> </span><span class="nv">cryptsetup</span>

<span class="nv">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">urandom</span><span class="w"> </span><span class="nv">of</span><span class="o">=/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">crypto_keyfile</span>.<span class="nv">bin</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="mi">1024</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="mi">4</span>
<span class="nv">chmod</span><span class="w"> </span><span class="mi">000</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">crypto_keyfile</span>.<span class="nv">bin</span>
<span class="nv">cryptsetup</span><span class="w"> </span><span class="nv">luksFormat</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">xda2</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">crypto_keyfile</span>.<span class="nv">bin</span>
<span class="nv">cryptsetup</span><span class="w"> </span><span class="nv">luksOpen</span><span class="w"> </span><span class="o">--</span><span class="nv">key</span><span class="o">-</span><span class="nv">file</span><span class="o">=/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">crypto_keyfile</span>.<span class="nv">bin</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">xda2</span><span class="w"> </span><span class="nv">crypt</span><span class="o">-</span><span class="nv">pool</span>
</code></pre></div>

<p>Look up the UUID</p>
<div class="highlight"><pre><span></span><code>blkid /dev/xda2
</code></pre></div>

<p>Edit <code>dmcrypt</code> service configuration in <code>/etc/conf.d/dmcrypt</code>:</p>
<div class="highlight"><pre><span></span><code>target=crypt-pool
source=&quot;UUID=xxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
key=/etc/crypto_keyfile.bin
</code></pre></div>

<p>And enable it with this command:</p>
<div class="highlight"><pre><span></span><code>rc-update add dmcrypt boot
</code></pre></div>

<p>At this point it would be good to backup:</p>
<ul>
<li><code>/etc/conf.d/dmcrypt</code></li>
<li><code>/etc/crypto_keyfile.bin</code></li>
</ul>
<p>Reboot and make sure that the block device gets created on start-up.</p>
<p>Add to LVM:</p>
<div class="highlight"><pre><span></span><code>vgcreate pool /dev/mapper/crypt-pool
lvcreate --name home0 -L 20G pool
</code></pre></div>

<p>Create your file-system and add it to <code>/etc/fstab</code>.</p>

	</article>


		  </div>

		  <div class="sidebar">

	        <nav>
	          <h2>Years</h2>
	          <ul>
	              <li class="active"><a href="/category/c2023.html">2023</a></li>
	              <li ><a href="/category/c2022.html">2022</a></li>
	              <li ><a href="/category/c2021.html">2021</a></li>
	              <li ><a href="/category/c2020.html">2020</a></li>
	              <li ><a href="/category/c2019.html">2019</a></li>
	              <li ><a href="/category/c2018.html">2018</a></li>
	              <li ><a href="/category/c2017.html">2017</a></li>
	              <li ><a href="/category/c2016.html">2016</a></li>
	              <li ><a href="/category/c2015.html">2015</a></li>
	              <li ><a href="/category/c2014.html">2014</a></li>
	              <li ><a href="/category/c2013.html">2013</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/alejandroliu/">github</a><i></i></li>
				  <li><a href="https://www.linkedin.com/in/alejandro-liu-ly/">LinkedIn</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Links</h2>
	            <ul>
	                <li><a href="/sitemap.html">sitemap</a></li>
	                <li><a href="/tags.html">Tags</a></li>
	                <li><a href="https://github.com/alejandroliu/0ink.net">Repo</a></li>
	                <li><a href="https://home.0ink.net/nanowiki/">Wiki</a></li>
	            </ul>
	          </aside>
	      </div>

	  </div>

      <footer>

		<p role="contentinfo">
		  © 2021-2022 Alejandro Liu - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
		  <span class="feeds">
		    <a href="/feeds/rss.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="rss feed" title="rss feed"/></a>
		  </span>
		  </p>

	  </footer>

	</div>


</body>
</html>