<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Docker on Alpine Linux</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Alpine Linux Quick installation See wiki For Alpine Linux > 3.8 Un-comment community repo from /etc/apk/repositories apk add docker rc-update add..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">0ink.net</a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/privacy-policy.html">Privacy Policy</a></li>
                    <li class="active"><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/docker-on-alpine-linux.html" rel="bookmark"
           title="Permalink to Docker on Alpine Linux">Docker on Alpine Linux</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-09-22T00:00:00+02:00">
                Published: Sat 22 September 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>

</footer><!-- /.post-info -->      <p>Alpine Linux Quick installation</p>
<p>See <a href="https://wiki.alpinelinux.org/wiki/Docker">wiki</a>  For Alpine Linux &gt; 3.8</p>
<ol>
<li>Un-comment community repo from <code>/etc/apk/repositories</code></li>
<li>apk add docker</li>
<li>rc-update add docker boot</li>
<li>service docker start</li>
</ol>
<p>Optional: (docker compose)</p>
<div class="highlight"><pre><span></span><code>apk add docker-compose
</code></pre></div>

<hr>
<p>Note 2021-03-21: When I tested this, the <code>daemon.json</code> did not
work!  Your mileage may vary.</p>
<hr>
<p>Recommended for user namespace isolation (not sure if this works)</p>
<p>Also is good to use data mode (persistent /var) as most docker data is stored there.</p>
<div class="highlight"><pre><span></span><code>adduser -SDHs /sbin/nologin dockremap
addgroup -S dockremap
echo dockremap:100000:65535 | tee /etc/subuid
echo dockremap:100000:65535 | tee /etc/subgid
</code></pre></div>

<p>In <code>/etc/docker/daemon.json</code>:</p>
<div class="highlight"><pre><span></span><code>{
        &quot;userns-remap&quot;: &quot;dockremap&quot;
}
</code></pre></div>

<p>For more info <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file">docker docs</a></p>
<h2>Test docker:</h2>
<ol>
<li>docker version</li>
<li>docker info</li>
<li>docker run hello-world</li>
<li>docker image ls</li>
<li>docker container ls</li>
<li>docker container ls --all</li>
<li>docker container ls --aq</li>
</ol>
<h2>Mounting NFS</h2>
<p>From docker 17.06, you can mount NFS shares to the container directly when you run it, without the need of extra capabilities</p>
<div class="highlight"><pre><span></span><code>docker run --mount &#39;type=volume,src=VOL_NAME,volume-driver=local,dst=/LOCAL-MNT,volume-opt=type=nfs,volume-opt=device=:/NFS-SHARE,&quot;volume-opt=o=addr=NFS-SERVER,vers=4,hard,timeo=600,rsize=1048576,wsize=1048576,retrans=2&quot;&#39; -d -it --name mycontainer ubuntu
</code></pre></div>

<h2>Useful options for docker</h2>
<ul>
<li><code>docker run -d</code> : Run as a daemon (runs in the background).</li>
<li>NFS mounting (pre 17.06)<ul>
<li><code>you@host &gt; mount server:/dir /path/to/mount/point</code></li>
<li><code>you@host &gt; docker run -v /path/to/mount/point:/path/to/mount/point</code></li>
</ul>
</li>
<li><code>docker run -p 4000:80</code> : Forward port 4000 to 80.
   So host listens on port 4000 and everything is forwarded to port 80 on the container.</li>
</ul>
<h2>Alpine Linux relocating /var/lib/docker</h2>
<p>In the file <code>/etc/conf.d/docker</code> you can add additional command line
options in:</p>
<p><code>DOCKER_OPTS</code></p>
<p>In particular you can use the <code>-g</code> option.</p>
<p>See <a href="https://linuxconfig.org/how-to-move-docker-s-default-var-lib-docker-to-another-directory-on-ubuntu-debian-linux">linuxconfig.org article</a></p>
<h2>Make your own docker image, quick example</h2>
<ul>
<li><a href="https://docs.docker.com/get-started/part2/#run-the-app">Run the app</a></li>
</ul>
<h2>Making changes to an existing image</h2>
<ul>
<li><code>docker run -i -t [--name guest] image_name /bin/bash|/bin/sh</code></li>
<li>... make changes to it ...</li>
<li><code>docker stop name|container_id</code></li>
<li>`docker commit -m 'change name' -a 'A N Other' container_id image_name<ul>
<li>container id: <code>$(docker ps -l -q)</code></li>
</ul>
</li>
<li><code>docker rm guest|container_id</code></li>
</ul>
<h2>Better way to create container images:</h2>
<ul>
<li><a href="https://serversforhackers.com/c/updating-containers">Updating containers</a></li>
</ul>
<h2>Just use them...</h2>
<ul>
<li><a href="https://github.com/maxexcloo/Docker">docker</a></li>
<li><a href="https://www.linuxserver.io/">linuxerver</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://www.iliu.net">Familia</a></li>
                            <li><a href="https://github.com/alejandroliu/0ink.net">github</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>