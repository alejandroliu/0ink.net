<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Raspberry Pi Weekend project</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="So finally took the time to try out a Raspberry Pi. For this weekend project wanted to do something relatively simple. Essentially, I wanted to..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">0ink.net</a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/privacy-policy.html">Privacy Policy</a></li>
                    <li class="active"><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/raspberry-pi-weekend-project.html" rel="bookmark"
           title="Permalink to Raspberry Pi Weekend project">Raspberry Pi Weekend project</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-04-26T00:00:00+02:00">
                Published: Sat 26 April 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>

</footer><!-- /.post-info -->      <p>So finally took the time to try out a Raspberry Pi. For this weekend project wanted to do something <em>relatively</em> simple.
Essentially, I wanted to recreate/enhance the functionality of a
<a href="http://www.tp-link.com/en/products/details/?model=TL-WR702N">TL-WR702N</a>.</p>
<p><img alt="tl-wr702n-01" src="/images/2014/TL-WR720N-01.jpg"></p>
<p>The TL-WR702N Nano Router is a neat device but being closed, can not be customized to what I wanted. It can be used in
the following modes:</p>
<ul>
<li>AP</li>
<li>Client</li>
<li>Repeater</li>
<li>Router</li>
<li>Bridge</li>
</ul>
<p>Specifically I was interested in the bridge mode. However, rather
than bridging from one SSID to another SSID, I wanted to <em>route/nat</em>
between the two. So in theory, should be simple to implement (as the
hardware should have all the necessary components) but not allowed by
the software.</p>
<h1>Enter the Raspberry Pi.</h1>
<p>So the Pi, is a mini computer that can be loaded with any software you want. The B-model, has a built-in Ethernet and USB ports to plug-in <em>two</em> WIFI adaptors. For this functionality I am using the following:</p>
<ul>
<li>Raspberry-Pi Model-B<br>
<img alt="Raspberry Pi" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Raspberry_Pi_B%2B_top.jpg/300px-Raspberry_Pi_B%2B_top.jpg"></li>
<li>WIFI stick (2 units)<br>
<img alt="WIFI" src="/images/2014/993655_LB_00_FB.EPS_250.jpg"></li>
</ul>
<p>For the software I am using:</p>
<ul>
<li><a href="https://github.com/gamaral/rpi-buildroot">Raspberry Pi buildroot</a></li>
<li><a href="http://www.realtek.com.tw/downloads/downloadsView.aspx?Langid=1&amp;PNid=21&amp;PFid=48&amp;Level=5&amp;Conn=4&amp;DownTypeID=3&amp;GetDown=false&amp;Downloads=true">hostapd-rtl8192cu from Realtek</a><br>
    You need to get the RTL8188CUS package for Linux.</li>
</ul>
<p>So you need two WIFI adaptors, as one will not work as master and slave at the same time. Essentially, one WIFI interface will act as the client WIFI station. The other WIFI interface acts as a WIFI hotspot. I chose to use <code>buildroot</code> instead of a normal Linux distro like <a href="http://www.raspbian.org/">Raspbian</a> or <a href="http://archlinuxarm.org/platforms/armv6/raspberry-pi">Arch Linux Arm</a> because I wanted to run it as an embedded system. Normal Linux distro's are supposed to be properly <em>shutdown</em> and would complain when you simply yank the power cord. The <code>buildroot</code> image I have is customized so that the file system is always mounted read-only. It will switch to read-write only to write persistent data and then switch back to read-only. The normal <code>hostapd</code> that comes with <code>buildroot</code> is the normal open source project and does not come with the <code>rtl8192cu</code> driver. You need to download and build the <code>Realtek</code> version. For this to work, I did the following:</p>
<ol>
<li>
<p>Create a start-up scripts that set the whole thing up.</p>
<ul>
<li>sets-up the filesystem</li>
<li>starts <code>syslog</code>, <code>sshd</code>, <code>rngd</code></li>
<li>sets-up <code>eth0</code> and <code>wlan0</code> to be configured by <code>ifplugd</code></li>
<li>starts <code>wpa_supplicant</code> on <code>wlan0</code></li>
<li>starts <code>httpd</code></li>
<li>start and configure <code>wlan1</code> as an Access Point.</li>
<li>start and configure <code>dnsmasq</code> for DNS and DHCP.</li>
<li>Wrote a small web UI to configure the WIFI client.</li>
</ul>
</li>
</ol>
<p>All this stuff can be found in <a href="https://github.com/alejandroliu/harpy">github</a>.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://www.iliu.net">Familia</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/alejandroliu/0ink.net">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>