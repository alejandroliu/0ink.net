<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>QNAP Snapshots - 0ink.net</title>
	<meta name="author" content="Alejandro Liu">


	<meta name="description" content="I wrote a small tool to access QNAP snapshots from the Linux command line. Pre-requistes: Snapshots have to be enabled You need a /share/netcfg containing the file: In my case, I set this share as read-only with root-squash. `admin.yaml' : contains the private/public keys and the configuration of …">
	<meta name="int-title" content="QNAP Snapshots">
	<meta name="tags" content="configuration, directory, linux">
	<meta name="date" content="2023-02-01 00:00:00+01:00">
	<meta name="modified" content="2023-01-11 15:59:49+01:00">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />


    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="0ink.net Atom Feed" />
    <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="0ink.net RSS Feed" />
</head>

<body>
    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	        <a href="/feeds/atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed" title="atom feed"/></a>
	    </div>
		<nav class="pages">
			    <a href="/pages/about.html">About</a>
-			    <a href="/pages/privacy-policy.html">Privacy Policy</a>
		</nav>
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		0ink.net</a>
	      <div class="logo">
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		  <img src="/images/2021/0ink.png" width="44" height="44" />
		</a>
	      </div>



      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
			<iframe src="https://duckduckgo.com/search.html?site=0ink.net&prefill=Search with DuckDuckGo" style="overflow:hidden;margin:5px;padding:0;width:408px;height:40px;" frameborder="0"></iframe>

	<article class="full">

		<h1>QNAP Snapshots</h1>

<div class="metadata">
  <time datetime="2023-02-01T00:00:00+01:00" pubdate>Wed 01 February 2023</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
    </address>
  <p>Updated: 2023-01-11 15:59:49+01:00</p>
  in <a href="/category/c2023.html">2023</a>
<p class="tags">tagged <a href="/tag/configuration.html">configuration</a>, <a href="/tag/directory.html">directory</a>, <a href="/tag/linux.html">linux</a></p></div>
		<p>I wrote a small tool to access QNAP snapshots from the Linux command line.</p>
<p>Pre-requistes:</p>
<ul>
<li>Snapshots have to be enabled</li>
<li>You need a <code>/share/netcfg</code> containing the file:<ul>
<li>In my case, I set this share as <code>read-only</code> with <code>root-squash</code>.</li>
<li>`admin.yaml' : contains the private/public keys and the configuration
  of the forced command.  For access control, it is only readable
  to group and the file is owned by the UNIX group that can do snapshot
  operations.</li>
<li><code>registry.yaml</code> : this is optional if you are changing the <code>admin</code> username.</li>
</ul>
</li>
</ul>
<p>Afterwards run:</p>
<ul>
<li><code>install_key.sh</code> <strong>server-name</strong></li>
</ul>
<p>This installs the public key into the <code>authorized keys</code>.  You will need
ssh access for this to work.</p>
<p>You need to do this on all the QNAP servers that offer snapshots.</p>
<p>Copy <code>qsnap</code> to somewhere in your path.</p>
<h2 id="usage">Usage</h2>
<h3 id="listing-snapshots">Listing snapshots</h3>
<div class="highlight"><pre><span></span><code>qsnap
</code></pre></div>

<p>List snapshots for the current directory</p>
<p><code>bash
qsnap ls file-path</code></p>
<p>List snapshots for the given <code>file-path</code>.  <code>file-path</code> can be provided
multiple times.</p>
<h3 id="reading-snapshot-files">Reading snapshot files</h3>
<div class="highlight"><pre><span></span><code>qsnap<span class="w"> </span>cat<span class="w"> </span><span class="o">[</span>--snap<span class="o">=</span>snapid<span class="o">]</span><span class="w"> </span>file1<span class="w"> </span><span class="o">[</span>file2<span class="w"> </span>file3<span class="w"> </span>...<span class="o">]</span>
</code></pre></div>

<p>Would display the given file(s) from the snapshot.  If <code>snapid</code> is not
specified will use the latest available snapshot.</p>
<h3 id="dumping-snapshots">Dumping snapshots</h3>
<p>``bash
qsnap tar [--snap=snapid] [options] path
```</p>
<p>Will dump the given <code>path</code> as a tarball.  If <code>snapid</code> is not
specified will use the latest available snapshot.</p>
<p>The <code>path</code> can be either a file or directory.</p>
<p>Additional options:</p>
<ul>
<li><code>--base64</code> : Data will be dumped using MIME Base64 encoding</li>
<li>'--no-compress' : Default is to compress.  This disables compression</li>
<li>'-v' : Pass <code>v</code> flag to <code>tar</code> command.</li>
</ul>
<p>All this can be found on <a href="https://github.com/alejandroliu/0ink.net/tree/master/snippets/qsnap">github</a>.</p>

	</article>


		  </div>

		  <div class="sidebar">

	        <nav>
	          <h2>Years</h2>
	          <ul>
	              <li class="active"><a href="/category/c2023.html">2023</a></li>
	              <li ><a href="/category/c2022.html">2022</a></li>
	              <li ><a href="/category/c2021.html">2021</a></li>
	              <li ><a href="/category/c2020.html">2020</a></li>
	              <li ><a href="/category/c2019.html">2019</a></li>
	              <li ><a href="/category/c2018.html">2018</a></li>
	              <li ><a href="/category/c2017.html">2017</a></li>
	              <li ><a href="/category/c2016.html">2016</a></li>
	              <li ><a href="/category/c2015.html">2015</a></li>
	              <li ><a href="/category/c2014.html">2014</a></li>
	              <li ><a href="/category/c2013.html">2013</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/alejandroliu/">github</a><i></i></li>
				  <li><a href="https://www.linkedin.com/in/alejandro-liu-ly/">LinkedIn</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Links</h2>
	            <ul>
	                <li><a href="/sitemap.html">sitemap</a></li>
	                <li><a href="/tags.html">Tags</a></li>
	                <li><a href="https://github.com/alejandroliu/0ink.net">Repo</a></li>
	                <li><a href="https://home.0ink.net/nanowiki/">Wiki</a></li>
	            </ul>
	          </aside>
	      </div>

	  </div>

      <footer>

		<p role="contentinfo">
		  © 2021-2022 Alejandro Liu - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
		  <span class="feeds">
		    <a href="/feeds/rss.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="rss feed" title="rss feed"/></a>
		  </span>
		  </p>

	  </footer>

	</div>


</body>
</html>