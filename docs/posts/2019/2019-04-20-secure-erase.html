<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>Secure erase of disc drives - 0ink.net</title>
	<meta name="author" content="Alejandro Liu">


	<meta name="description" content="This article is about erasing disc drives securely. Specially for SSD drives, writing zeros or random data to discs is not good enough and counterproductive. One way to do secure erase (for disposal) is to begin with an encrypted disc. However, after the fact the following options are possible: ATA …">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />


</head>

<body>

    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	    </div>
		<nav class="pages">
			    <a href="/pages/about.html">About</a>
-			    <a href="/pages/privacy-policy.html">Privacy Policy</a>
		</nav>
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		0ink.net</a>
	      <div class="logo">
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		  <img src="/images/2021/0ink.png" width="44" height="44" />
		</a>
	      </div>



      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
			<iframe src="https://duckduckgo.com/search.html?site=0ink.net&prefill=Search with DuckDuckGo" style="overflow:hidden;margin:5px;padding:0;width:408px;height:40px;" frameborder="0"></iframe>

	<article class="full">

		<h1>Secure erase of disc drives</h1>

<div class="metadata">
  <time datetime="2019-04-20T00:00:00+02:00" pubdate>Sat 20 April 2019</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
    </address>
  in <a href="/category/2019.html">2019</a>
</div>
		<p>This article is about erasing disc drives securely.  Specially for SSD
drives, writing zeros or random data to discs is not good enough and
counterproductive.</p>
<p>One way to do secure erase (for disposal) is to begin with an encrypted
disc.  However, after the fact the following options are possible:</p>
<h1>ATA Secure Erase</h1>
<p>You should use the drive's security erase feature.</p>
<p>Make sure the drive Security is not frozen. If it is, it may help to suspend and resume the computer.</p>
<div class="highlight"><pre><span></span><code>$ sudo hdparm -I /dev/sdX <span class="p">|</span> grep frozen
       not     frozen 
</code></pre></div>

<p>The (filtered) command output means that this drive is ”not frozen” and you can continue.</p>
<p>Set a User Password (this password is cleared too, the exact choice does not matter).</p>
<div class="highlight"><pre><span></span><code>sudo hdparm --user-master u --security-set-pass Eins /dev/sdX
</code></pre></div>

<p>Issue the ATA Secure Erase command</p>
<div class="highlight"><pre><span></span><code>sudo hdparm --user-master u --security-erase Eins /dev/sdX
</code></pre></div>

<p>Notes:</p>
<ul>
<li>/dev/sdX is the SSD as a block device that you want to erase.</li>
<li>Eins is the password chosen in this example.</li>
</ul>
<p>See the ATA Secure Erase article in the <a href="https://ata.wiki.kernel.org/index.php/ATA_Secure_Erase">Linux kernel wiki</a> for
complete instructions including troubleshooting.</p>
<p>If for some reason you need to remove the password use:</p>
<div class="highlight"><pre><span></span><code>sudo hdparm --security-disable Eins
</code></pre></div>

<h1>blkdiscard</h1>
<p><code>util-linux 2.23</code> offers <a href="http://man7.org/linux/man-pages/man8/blkdiscard.8.html">blkdiscard</a> which discards data without
secure-wiping them.  This has been tested to work over SATA and mmcblk
but not USB.</p>
<p>An excerpt from the manual page of <code>blkdiscard(8)</code>:</p>
<hr>
<h2>NAME</h2>
<p>blkdiscard - discard sectors on a device</p>
<h2>SYNOPSIS</h2>
<div class="highlight"><pre><span></span><code>blkdiscard [-o offset] [-l length] [-s] [-v] device
</code></pre></div>

<h2>DESCRIPTION</h2>
<p><code>blkdiscard</code> is used to discard device sectors. This is useful for
solid-state drivers (SSDs) and thinly-provisioned storage. Unlike
<code>fstrim(8)</code> this command is used directly on the block device.</p>
<p>By default, <code>blkdiscard</code> will discard all blocks on the device. Options
may be used to modify this behavior based on range or size, as explained
below.</p>
<p>The device argument is the pathname of the block device.</p>
<p><strong>WARNING: All data in the discarded region on the device will be lost!</strong></p>
<hr>
<h1>Use TRIM</h1>
<p>To enable TRIM:</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/fstab
</code></pre></div>

<p>Change <code>ext4 errors=remount-ro 0" into "ext4 discard,errors=remount-ro 0</code>.
<strong>(Add discard)</strong></p>
<p>Save and reboot, TRIM should now be enabled.</p>
<p>Check if TRIM is enabled:</p>
<div class="highlight"><pre><span></span><code><span class="nv">sudo</span> <span class="nv">dd</span> <span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">urandom</span> <span class="nv">of</span><span class="o">=</span><span class="nv">tempfile</span> <span class="nv">count</span><span class="o">=</span><span class="mi">100</span> <span class="nv">bs</span><span class="o">=</span><span class="mi">512</span><span class="nv">k</span> <span class="nv">oflag</span><span class="o">=</span><span class="nv">direct</span>
<span class="nv">sudo</span> <span class="nv">hdparm</span> <span class="o">--</span><span class="nv">fibmap</span> <span class="nv">tempfile</span>
</code></pre></div>

<p>Use the first begin_LBA address.</p>
<div class="highlight"><pre><span></span><code><span class="n">hdparm</span><span class="w"> </span><span class="c1">--read-sector [begin_LBA] /dev/sda</span>
</code></pre></div>

<p>Now it should return numbers and characters. Remove the file and sync.</p>
<div class="highlight"><pre><span></span><code>rm tempfile
sync
</code></pre></div>

<p>Now, run the following command again. If it returns zeros TRIM is enabled.</p>
<div class="highlight"><pre><span></span><code><span class="n">hdparm</span><span class="w"> </span><span class="c1">--read-sector [begin_LBA] /dev/sda</span>
</code></pre></div>

<p>Another option is to use the <a href="http://man7.org/linux/man-pages/man8/fstrim.8.html">fstrim</a> command.</p>
<h1>Old fashioned writes</h1>
<p>This is what I used to do for magnetic discs.  Note, that this is
discouraged for SSD devices:</p>
<p>First I create some random data to use:</p>
<div class="highlight"><pre><span></span><code><span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span> <span class="n">of</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">random</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span> <span class="n">count</span><span class="o">=</span><span class="mi">128</span>
</code></pre></div>

<p>Then we write random data to disc:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">while</span> <span class="p">:</span> <span class="p">;</span> <span class="n">do</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">random</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="n">k</span> <span class="p">;</span> <span class="n">done</span> <span class="p">)</span> <span class="o">|</span> <span class="n">pv</span> <span class="o">|</span> <span class="n">dd</span> <span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdX</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="n">k</span>
</code></pre></div>

<p>The <code>pv</code> part of the pipe is <strong>optional</strong>.</p>
<p>Afterwards:</p>
<div class="highlight"><pre><span></span><code><span class="nv">dd</span> <span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">zero</span> <span class="nv">of</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sdX</span> <span class="nv">bs</span><span class="o">=</span><span class="mi">4</span><span class="nv">k</span>
</code></pre></div>

	</article>


		  </div>

		  <div class="sidebar">

	        <nav>
	          <h2>Years</h2>
	          <ul>
	              <li ><a href="/category/2021.html">2021</a></li>
	              <li ><a href="/category/2020.html">2020</a></li>
	              <li class="active"><a href="/category/2019.html">2019</a></li>
	              <li ><a href="/category/2018.html">2018</a></li>
	              <li ><a href="/category/2017.html">2017</a></li>
	              <li ><a href="/category/2016.html">2016</a></li>
	              <li ><a href="/category/2015.html">2015</a></li>
	              <li ><a href="/category/2014.html">2014</a></li>
	              <li ><a href="/category/2013.html">2013</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/alejandroliu/">github</a><i></i></li>
				  <li><a href="https://www.linkedin.com/in/alejandro-liu-ly/">LinkedIn</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Links</h2>
	            <ul>
	                <li><a href="https://github.com/alejandroliu/0ink.net">Repo</a></li>
	                <li><a href="https://alejandro.iliu.net/">Alejandro</a></li>
	            </ul>
	          </aside>
	      </div>

	  </div>

      <footer>

		<p role="contentinfo">
		  © 2013 Alejandro Liu - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
    	</p>

	  </footer>

	</div>


</body>
</html>