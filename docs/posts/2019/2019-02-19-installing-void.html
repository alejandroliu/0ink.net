<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>Installing Void Linux - 0ink.net</title>
	<meta name="author" content="Alejandro Liu">


	<meta name="description" content="I made the switch to void linux. Except for compatibility issues around glibc, it works quite well. Most compatibility I have worked around with a combination of Flatpaks, chroots and namespaces. The high lights of void linux: musl build - which is very lightweigth Does not depend on systemd …">
	<meta name="int-title" content="Installing Void Linux">
	<meta name="tags" content="backups, boot, configuration, desktop, device, directory, drive, filesystem, installation, linux, login, manager, network, partition, password, power, scripts, security, software, sudo, windows">
	<meta name="date" content="2019-02-19 00:00:00+01:00">
	<meta name="modified" content="2022-01-10 17:29:50+01:00">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />


    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="0ink.net Atom Feed" />
    <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="0ink.net RSS Feed" />
</head>

<body>
    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	        <a href="/feeds/atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed" title="atom feed"/></a>
	    </div>
		<nav class="pages">
			    <a href="/pages/about.html">About</a>
-			    <a href="/pages/privacy-policy.html">Privacy Policy</a>
		</nav>
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		0ink.net</a>
	      <div class="logo">
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		  <img src="/images/2021/0ink.png" width="44" height="44" />
		</a>
	      </div>



      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
			<iframe src="https://duckduckgo.com/search.html?site=0ink.net&prefill=Search with DuckDuckGo" style="overflow:hidden;margin:5px;padding:0;width:408px;height:40px;" frameborder="0"></iframe>

	<article class="full">

		<h1>Installing Void Linux</h1>

<div class="metadata">
  <time datetime="2019-02-19T00:00:00+01:00" pubdate>Tue 19 February 2019</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
    </address>
  <p>Updated: 2022-01-10 17:29:50+01:00</p>
  in <a href="/category/c2019.html">2019</a>
<p class="tags">tagged <a href="/tag/backups.html">backups</a>, <a href="/tag/boot.html">boot</a>, <a href="/tag/configuration.html">configuration</a>, <a href="/tag/desktop.html">desktop</a>, <a href="/tag/device.html">device</a>, <a href="/tag/directory.html">directory</a>, <a href="/tag/drive.html">drive</a>, <a href="/tag/filesystem.html">filesystem</a>, <a href="/tag/installation.html">installation</a>, <a href="/tag/linux.html">linux</a>, <a href="/tag/login.html">login</a>, <a href="/tag/manager.html">manager</a>, <a href="/tag/network.html">network</a>, <a href="/tag/partition.html">partition</a>, <a href="/tag/password.html">password</a>, <a href="/tag/power.html">power</a>, <a href="/tag/scripts.html">scripts</a>, <a href="/tag/security.html">security</a>, <a href="/tag/software.html">software</a>, <a href="/tag/sudo.html">sudo</a>, <a href="/tag/windows.html">windows</a></p></div>
		<p>I made the switch to <a href="https://voidlinux.org" title="Void Linux">void linux</a>.  Except for compatibility
issues around <code>glibc</code>, it works quite well.  Most compatibility
I have worked around with a combination of <code>Flatpak</code>s, <code>chroot</code>s and
<code>namespaces</code>.</p>
<p>The high lights of <a href="https://voidlinux.org" title="Void Linux">void linux</a>:</p>
<ul>
<li>musl build - which is very lightweigth</li>
<li>Does not depend on <code>systemd</code></li>
<li>a reasonable selection of software packages</li>
</ul>
<p>I have tweaked the installation on my computers to use UEFI and thus
I am using <a href="http://www.rodsbooks.com/refind/" title="rEFInd bootloader">rEFInd</a> instead of grub.  This is because it makes
doing bare metal backups and restore just a simple file copy.</p>
<p>My installation process roughly follows the <a href="https://wiki.voidlinux.org/Installation_on_UEFI,_via_chroot" title="Install void linux on UEFI via chroot">UEFI chroot install</a>.</p>
<p>This process is implemented in a script and can be found here:</p>
<ul>
<li><a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/install.sh">install.sh</a></li>
</ul>
<p>Script usage:</p>
<div class="highlight"><pre><span></span><code>    Usage: installer.sh <span class="ge">_/dev/sdx_</span> <span class="ge">_hostname_</span> [options]

<span class="w">    </span><span class="k">-</span><span class="w"> </span><span class="ge">_sdx_</span>: Block device to install to or
<span class="w">      </span><span class="k">-</span><span class="w"> </span>--image=filepath[:size] to create a virtual disc image
<span class="w">      </span><span class="k">-</span><span class="w"> </span>--imgset=filebase[:size] to create a virtual filesystem image set
<span class="w">      </span><span class="k">-</span><span class="w"> </span>--dir=dirpath to create a directory
<span class="w">    </span><span class="k">-</span><span class="w"> </span><span class="ge">_hostname_</span>: Hostname to use

    Options:
<span class="w">    </span><span class="k">-</span><span class="w"> </span>swap=kbs : swap size, defaults computed from /proc/meminfo, uses numfmt to parse values
<span class="w">    </span><span class="k">-</span><span class="w"> </span>glibc : Do a glibc install
<span class="w">    </span><span class="k">-</span><span class="w"> </span>noxwin : do not insall X11 related packages
<span class="w">    </span><span class="k">-</span><span class="w"> </span>nodesktop ; do not install desktop environment
<span class="w">    </span><span class="k">-</span><span class="w"> </span>desktop=mate : Install MATE dekstop environment
<span class="w">    </span><span class="k">-</span><span class="w"> </span>passwd=password : root password (prompt if not specified)
<span class="w">    </span><span class="k">-</span><span class="w"> </span>enc-passwd=encrypted : encrypted root password.
<span class="w">    </span><span class="k">-</span><span class="w"> </span>ovl=tar.gz : tarball containing additional files
<span class="w">    </span><span class="k">-</span><span class="w"> </span>post=script : run a post install script
<span class="w">    </span><span class="k">-</span><span class="w"> </span>pkgs=file : text file containing additional software to install
<span class="w">    </span><span class="k">-</span><span class="w"> </span>bios : create a BIOS boot system (needs syslinux)
<span class="w">    </span><span class="k">-</span><span class="w"> </span>cache=path : use the file path for download cache
<span class="w">    </span><span class="k">-</span><span class="w"> </span>xen : do some xen specific tweaks
</code></pre></div>

<h4 id="command-line-examples">Command line examples</h4>
<ul>
<li>sudo sh install.sh --dir=$HOME/vx9 vx9 swap=4G glibc passwd=1234567890 cache=$HOME/void-cache xen</li>
<li>sudo sh install.sh --dir=$HOME/vx1 vx1 swap=4G glibc passwd=1234567890 cache=$HOME/void-cache xen</li>
<li>sudo sh install.sh --dir=$HOME/vx11 vx11 swap=4G       passwd=1234567890 cache=$HOME/void-cache xen</li>
</ul>
<h3 id="initial-set-up">Initial set-up</h3>
<p>Boot using the void live CD and partition the target disk:</p>
<div class="highlight"><pre><span></span><code>cfdisk<span class="w"> </span>-z<span class="w"> </span>/dev/xda
</code></pre></div>

<p>Make sure you use <code>gpt</code> label type (for UEFI boot).  I am creating
the following partitions:</p>
<ol>
<li>500MB <code>EFI System</code></li>
<li><em>RAM Size * 1.5</em> <code>Linux swap</code>, Mainly used for Hibernate.</li>
<li><em>Rest of drive</em> <code>Linux filesystem</code>, Root file system</li>
</ol>
<p>This is on a USB thumb drive.  The data I keep on an internal disk.</p>
<p>Now we create the filesystems:</p>
<div class="highlight"><pre><span></span><code>mkfs.vfat<span class="w"> </span>-F<span class="w"> </span><span class="m">32</span><span class="w"> </span>-n<span class="w"> </span>EFI<span class="w"> </span>/dev/xda1
mkswap<span class="w"> </span>-L<span class="w"> </span>swp0<span class="w"> </span>/dev/xda2
mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span>voidlinux<span class="w"> </span>/dev/xda3
</code></pre></div>

<p>We're now ready to mount the volumes, making any necessary mount point directories along the way (the sequence is important, yes):</p>
<div class="highlight"><pre><span></span><code>mount<span class="w"> </span>/dev/xda3<span class="w"> </span>/mnt
mkdir<span class="w"> </span>/mnt/boot
mount<span class="w"> </span>/dev/xda1<span class="w"> </span>/mnt/boot
</code></pre></div>

<h3 id="installing-void">Installing Void</h3>
<p>So we do a targeted install:</p>
<p>For musl-libc</p>
<div class="highlight"><pre><span></span><code>env<span class="w"> </span><span class="nv">XBPS_ARCH</span><span class="o">=</span>x86_64-musl<span class="w"> </span>xbps-install<span class="w"> </span>-S<span class="w"> </span>-R<span class="w"> </span>http://alpha.de.repo.voidlinux.org/current/musl<span class="w"> </span>-r<span class="w"> </span>/mnt<span class="w"> </span>base-system<span class="w"> </span>grub-x86_64-efi
</code></pre></div>

<p>For glibc</p>
<div class="highlight"><pre><span></span><code>env<span class="w"> </span><span class="nv">XBPS_ARCH</span><span class="o">=</span>x86_64<span class="w"> </span>xbps-install<span class="w"> </span>-S<span class="w"> </span>-R<span class="w"> </span>http://alpha.de.repo.voidlinux.org/current<span class="w"> </span>-r<span class="w"> </span>/mnt<span class="w"> </span>base-system<span class="w"> </span>grub-x86_64-efi
</code></pre></div>

<p>But actually, for the package list I have been using these lists:</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist.txt"></script>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist-xwin.txt?footer=minimal"></script>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist-mate.txt?footer=minimal"></script>

<p>This installs a <a href="https://mate-desktop.org/" title="MATE Desktop environment">MATE</a> desktop environment.</p>
<h4 id="software-selection-notes">Software selection notes</h4>
<ul>
<li>For time synchronisation (ntp) we ae choosing <code>chrony</code> as it is
  reputed to be more secure that <code>ntpd</code> and more compliant than
  <code>openntpd</code>.</li>
<li>We are using the default configuration, which should be OK.  Uses
  <code>pool.ntp.org</code> for the time server which would use a suitable
  default.</li>
<li>For <code>cron</code> we are using <code>dcron</code>.  It is full featured (i.e.
  compatibnle with <code>cron</code> and it can handle power-off situations,
  while being the most light-weight option available.
  See: <a href="https://voidlinux.org/faq/#cron">VoidLinux FAQ: Cron</a></li>
<li>Includes <code>autofs</code> and <code>nfs-utils</code> for network filesystems and
  automount support.</li>
</ul>
<h3 id="nonfree-software-and-other-repositories">nonfree software and other repositories</h3>
<p>Additional repositories are available to support either
non-free software and in the case of glibc, multilib (32 bit)
binaries.</p>
<p>To enable under the musl version:</p>
<div class="highlight"><pre><span></span><code>env<span class="w"> </span><span class="nv">XBPS_ARCH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$arch</span><span class="s2">&quot;</span><span class="w"> </span>xbps-install<span class="w"> </span>-y<span class="w"> </span>-S<span class="w"> </span>-R<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$voidurl</span><span class="s2">&quot;</span><span class="w"> </span>-r<span class="w"> </span>/mnt<span class="w"> </span>void-repo-nonfree
</code></pre></div>

<p>For glibc:</p>
<div class="highlight"><pre><span></span><code>env<span class="w"> </span><span class="nv">XBPS_ARCH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$arch</span><span class="s2">&quot;</span><span class="w"> </span>xbps-install<span class="w"> </span>-y<span class="w"> </span>-S<span class="w"> </span>-R<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$voidurl</span><span class="s2">&quot;</span><span class="w"> </span>-r<span class="w"> </span>/mnt<span class="w"> </span>void-repo-nonfree<span class="w"> </span>void-repo-multilib<span class="w"> </span>void-repo-multilib-nonfree
</code></pre></div>

<p>Then you can install non-free software, like:</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/swlist-nonfree.txt"></script>

<h3 id="enter-the-void-chroot">Enter the void chroot</h3>
<p>Upon completion of the install, we set up our chroot jail, and chroot into our mounted filesystem:</p>
<div class="highlight"><pre><span></span><code>mount<span class="w"> </span>-t<span class="w"> </span>proc<span class="w"> </span>proc<span class="w"> </span>/mnt/proc
mount<span class="w"> </span>-t<span class="w"> </span>sysfs<span class="w"> </span>sys<span class="w"> </span>/mnt/sys
mount<span class="w"> </span>-o<span class="w"> </span><span class="nb">bind</span><span class="w"> </span>/dev<span class="w"> </span>/mnt/dev
mount<span class="w"> </span>-t<span class="w"> </span>devpts<span class="w"> </span>pts<span class="w"> </span>/mnt/dev/pts
cp<span class="w"> </span>-L<span class="w"> </span>/etc/resolv.conf<span class="w"> </span>/mnt/etc/
chroot<span class="w"> </span>/mnt<span class="w"> </span>bash<span class="w"> </span>-il
</code></pre></div>

<p>In order to verify our install, we can have a look at the directory structure:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>ls<span class="w"> </span>-la
</code></pre></div>

<p>The output should look something akin to the following:</p>
<div class="highlight"><pre><span></span><code>total 12
drwxr-xr-x 16 root root 4096 Jan 17 15:27 .
drwxr-xr-x  3 root root 4096 Jan 17 15:16 ..
lrwxrwxrwx  1 root root    7 Jan 17 15:26 bin -&gt; usr/bin
drwxr-xr-x  4 root root  127 Jan 17 15:37 boot
drwxr-xr-x  2 root root   17 Jan 17 15:26 dev
drwxr-xr-x 26 root root 4096 Jan 17 15:27 etc
drwxr-xr-x  2 root root    6 Jan 17 15:26 home
lrwxrwxrwx  1 root root    7 Jan 17 15:26 lib -&gt; usr/lib
lrwxrwxrwx  1 root root    9 Jan 17 15:26 lib32 -&gt; usr/lib32
lrwxrwxrwx  1 root root    7 Jan 17 15:26 lib64 -&gt; usr/lib
drwxr-xr-x  2 root root    6 Jan 17 15:26 media
drwxr-xr-x  2 root root    6 Jan 17 15:26 mnt
drwxr-xr-x  2 root root    6 Jan 17 15:26 opt
drwxr-xr-x  2 root root    6 Jan 17 15:26 proc
drwxr-x---  2 root root   26 Jan 17 15:39 root
drwxr-xr-x  3 root root   17 Jan 17 15:26 run
lrwxrwxrwx  1 root root    8 Jan 17 15:26 sbin -&gt; usr/sbin
drwxr-xr-x  2 root root    6 Jan 17 15:26 sys
drwxrwxrwt  2 root root    6 Jan 17 15:15 tmp
drwxr-xr-x 11 root root  123 Jan 17 15:26 usr
drwxr-xr-x 11 root root  150 Jan 17 15:26 var
</code></pre></div>

<p>While chrooted, we create the password for the root user, and set root access permissions:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>passwd<span class="w"> </span>root
<span class="w"> </span>chown<span class="w"> </span>root:root<span class="w"> </span>/
<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/
</code></pre></div>

<p>Since I am a <code>bash</code> convert, I would do this:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>xbps-alternatives<span class="w"> </span>--set<span class="w"> </span>bash
</code></pre></div>

<p>Create the <code>hostname</code> for the new install:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>&lt;HOSTNAME&gt;<span class="w"> </span>&gt;<span class="w"> </span>/etc/hostname
</code></pre></div>

<p>Edit our <code>/etc/rc.conf</code> file, like so:</p>
<div class="highlight"><pre><span></span><code><span class="nv">HOSTNAME</span><span class="o">=</span><span class="s2">&quot;&lt;HOSTNAME&gt;&quot;</span>

<span class="c1"># Set RTC to UTC or localtime.</span>
<span class="nv">HARDWARECLOCK</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span>

<span class="c1"># Set timezone, availables timezones at /usr/share/zoneinfo.</span>
<span class="nv">TIMEZONE</span><span class="o">=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span>

<span class="c1"># Keymap to load, see loadkeys(8).</span>
<span class="nv">KEYMAP</span><span class="o">=</span><span class="s2">&quot;us-acentos&quot;</span>

<span class="c1"># Console font to load, see setfont(8).</span>
<span class="c1">#FONT=&quot;lat9w-16&quot;</span>

<span class="c1"># Console map to load, see setfont(8).</span>
<span class="c1">#FONT_MAP=</span>

<span class="c1"># Font unimap to load, see setfont(8).</span>
<span class="c1">#FONT_UNIMAP=</span>

<span class="c1"># Kernel modules to load, delimited by blanks.</span>
<span class="c1">#MODULES=&quot;&quot;</span>
</code></pre></div>

<p>Also, modify the <code>/etc/fstab</code>:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span>
<span class="gh"># See fstab(5).</span>

<span class="gh"># &lt;file system&gt; &lt;dir&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
tmpfs       /tmp    tmpfs   defaults,nosuid,nodev   0       0
LABEL=EFI   /boot   vfat    rw,fmask=0133,dmask=0022,noatime,discard  0 2
LABEL=voidlinux /   xfs rw,relatime,discard 0 1
LABEL=swp0  swap    swap    defaults        0 0
</code></pre></div>

<p>For a removable drive I include the line:</p>
<div class="highlight"><pre><span></span><code>LABEL=volume    /media/blahblah xfs rw,relatime,nofail 0 0
</code></pre></div>

<p>The important setting here is <strong>nofail</strong>.  When the drive is
available it gets mounted.  If not, the <strong>nofail</strong> prevents
this to cause the boot sequence to stop.</p>
<p>If using <code>glibc</code> you can modify <code>/etc/default/libc-locales</code> and
uncomment:</p>
<p><code>en_US.UTF-8 UTF-8</code></p>
<p>Or whatever locale you want to use.  And run:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>xbps-reconfigure<span class="w"> </span>-f<span class="w"> </span>glibc-locales
</code></pre></div>

<h3 id="set-up-uefi-boot">Set-up UEFI boot</h3>
<p>Download the <a href="http://www.rodsbooks.com/refind/" title="rEFInd bootloader">rEFInd</a> zip binary from:</p>
<ul>
<li><a href="http://www.rodsbooks.com/refind/getting.html" title="rEFInd download page">rEFInd download</a></li>
</ul>
<p>Set-up the boot partition:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/boot/EFI
mkdir<span class="w"> </span>/boot/EFI/BOOT
</code></pre></div>

<p>Copy from the <code>zip file</code> the file <code>refind-bin-{version}/refind/refind_x64.efi</code> to
<code>/boot/EFI/BOOT/BOOTX64.EFI</code>.</p>
<p>The version I am using right now can be found here: <a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/BOOTX64.EFI">v0.11.4 BOOTX64.EFI</a></p>
<p>Create kernel options files <code>/boot/cmdline</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">root</span><span class="o">=</span><span class="nv">LABEL</span><span class="o">=</span>voidlinux<span class="w"> </span>ro<span class="w"> </span>quiet
</code></pre></div>

<p>For my hardware I had to add the option:</p>
<ul>
<li><code>intel_iommu=igfx_off</code></li>
<li>To work around some strange bug.</li>
<li><code>i915.enable_ips=0</code></li>
<li>fixes a power saving mode problem on 4.1-rc6+</li>
</ul>
<p>Create the following script as <code>/boot/mkmenu.sh</code></p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/mkmenu.sh"></script>

<p>Add the following scripts to:</p>
<ul>
<li><code>/etc/kernel.d/post-install/99-refind</code></li>
<li><code>/etc/kernel.d/post-remove/99-refind</code></li>
</ul>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/hook.sh"></script>

<p>Make sure they are executable.  This is supposed to re-create
menu entries whenever the kernel gets upgraded.</p>
<p>We need to have a look at <code>/lib/modules</code> to get our Linux kernel version</p>
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span>-la<span class="w"> </span>/lib/modules
</code></pre></div>

<p>Which should return something akin to:</p>
<div class="highlight"><pre><span></span><code>drwxr-xr-x  3 root root   21 Jan 31 15:22 .
drwxr-xr-x 23 root root 8192 Jan 31 15:22 ..
drwxr-xr-x  3 root root 4096 Jan 31 15:22 5.2.13_1
</code></pre></div>

<p>And this script to create boot files:</p>
<div class="highlight"><pre><span></span><code>xbps-reconfigure<span class="w"> </span>-f<span class="w"> </span>linux5.2
</code></pre></div>

<p>If you need to manually prepare boot files:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># update dracut</span>
dracut<span class="w"> </span>--force<span class="w"> </span>--kver<span class="w"> </span><span class="m">4</span>.19.4_1
<span class="c1"># update refind menu</span>
bash<span class="w"> </span>/boot/mkmenu.sh
</code></pre></div>

<p>We are now ready to boot into <a href="https://voidlinux.org" title="Void Linux">Void</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nb">exit</span>
umount<span class="w"> </span>-R<span class="w"> </span>/mnt
reboot
</code></pre></div>

<h3 id="post-install">Post install</h3>
<p>After the first boot, we need to activate services:</p>
<p>Command line set-up:</p>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/dhcpcd<span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/sshd<span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/<span class="o">{</span>acpid,chronyd,cgmanager,crond,uuidd,statd,rcpbind,autofs<span class="o">}</span><span class="w"> </span>/var/service
</code></pre></div>

<p>Full workstation set-up:</p>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/dbus<span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/NetworkManager<span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/sshd<span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/<span class="o">{</span>acpid,chronyd,cgmanager,crond,uuidd,statd,rcpbind,autofs<span class="o">}</span><span class="w"> </span>/var/service
ln<span class="w"> </span>-s<span class="w"> </span>/etc/sv/<span class="o">{</span>consolekit,xdm<span class="o">}</span><span class="w"> </span>/var/service
</code></pre></div>

<p>Creating new users:</p>
<div class="highlight"><pre><span></span><code>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span>-U<span class="w"> </span>-G<span class="w"> </span>wheel,users,audio,video,cdrom,input<span class="w"> </span>newuser
passwd<span class="w"> </span>newuser
</code></pre></div>

<p>Note: The <code>wheel</code> user group allows the user to escalate to root.</p>
<p>Configure sudo:</p>
<div class="highlight"><pre><span></span><code>visudo
</code></pre></div>

<p>Uncomment:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># %wheel ALL=(ALL) ALL</span>
</code></pre></div>

<h3 id="configure-keyboard">Configure keyboard</h3>
<p>Create configuration file: <code>/etc/X11/xorg.conf.d/30-keyboard.conf</code></p>
<div class="highlight"><pre><span></span><code><span class="se">Section</span> <span class="se">&quot;InputClass&quot;</span>
    <span class="nb">Identifier</span> <span class="no">&quot;keyboard-all&quot;</span>
    <span class="nb">Option</span> <span class="no">&quot;XkbLayout&quot; &quot;us&quot;</span>
    <span class="c"># Option &quot;XkbModel&quot; &quot;pc105&quot;</span>
    <span class="c"># Option &quot;XkbVariant&quot; &quot;altgr-intl&quot;</span>
    <span class="nb">Option</span> <span class="no">&quot;XkbVariant&quot; &quot;intl&quot;</span>
    <span class="c"># MatchIsKeyboard &quot;on&quot;</span>
<span class="se">EndSection</span>
</code></pre></div>

<p>This makes the <code>intl</code> for the <code>XkbVariant</code> the system-wide default.</p>
<p>Since, as a programmer I prefer the <code>altgr-intl</code> variant, then I
run this in my de desktop environment startup to override the
default:</p>
<div class="highlight"><pre><span></span><code>setxkbmap<span class="w"> </span>-rules<span class="w"> </span>evdev<span class="w"> </span>-model<span class="w"> </span>evdev<span class="w"> </span>-layout<span class="w"> </span>us<span class="w"> </span>-variant<span class="w"> </span>altgr-intl
</code></pre></div>

<h3 id="using-xdm">Using xdm</h3>
<p>I have switched to <a href="https://en.wikipedia.org/wiki/XDM_(display_manager)">xdm</a> as my display manager.  This is
configured in <code>/etc/X11/xdm/xdm-config</code>.</p>
<p>Specifically, I update the Xsession setting to be the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">! DisplayManager*session</span><span class="p">:</span><span class="w"> </span><span class="s">      /usr/lib64/X11/xdm/Xsession</span>
<span class="n">DisplayManager*session</span><span class="p">:</span><span class="w"> </span><span class="s">    /etc/X11/Xsession</span>
</code></pre></div>

<p>And have a custom <a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/xdm/Xsession">Xsession</a> script in
<code>/etc/X11/Xsession</code>.</p>
<p>Particularly important is the fact that the default Xsession
script is not able to start a <code>mate</code> or <code>xfce4</code> sessions
until you add the command:</p>
<div class="highlight"><pre><span></span><code>xhost<span class="w"> </span>+local:
</code></pre></div>

<p>Apparently there is somewhat of an issue in the way <code>xauth</code>
is handled.</p>
<p><strong>NOTE:</strong> <em>Doing <code>xhost +local:</code> is hardly a best practice
when it comes to security.</em></p>
<h4 id="spicing-up-xdm">Spicing up XDM</h4>
<p>Allthough <a href="https://en.wikipedia.org/wiki/XDM_(display_manager)">xdm</a> is fairly old-school, there are
still some opportunities to add some eye-candy to
it.  For that, we change the <code>setup</code> and <code>startup</code> scripts
<code>Xsetup_0</code> and <code>GiveConsole</code> into custom scripts:</p>
<ul>
<li><a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/xdm/Xsetup_0">Xsetup_0</a></li>
<li><a href="https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/xdm/GiveConsole">GiveConsole</a></li>
</ul>
<p>Unfortunately, it only works for applications that draw
directly to the root window as it is not possible to control
overlapping windows.  For example, running <code>cmatrix</code> on
a <code>xterm</code> window covers the login widget.</p>
<p>On the other hand, the <a href="https://www.jwz.org/xscreensaver/">xscreensaver</a> collection of screen
hacks seem to accept the <code>-root</code> parameter, which can be used
to kick off the hack, drawing on the root window.</p>
<h3 id="tweaks-and-bug-fixes">Tweaks and Bug-fixes</h3>
<h4 id="etcmachine-id-or-varlibdbusmachine-id">/etc/machine-id or /var/lib/dbus/machine-id</h4>
<p>Because we don't use <code>systemd</code>, we need to create <code>/etc/machine-id</code>
and <code>/var/lib/dbus/machine-id</code>.
manually.  This is only needed for desktop systems.</p>
<p>See [this article][machineid] for more
info.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>dbus-uuidgen<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/machine-id<span class="w"> </span>/var/lib/dbus/machine-id
</code></pre></div>

<h4 id="power-button-handling">power button handling</h4>
<p>This patch prevents the /etc/acpi/handler.sh to handle the power button
instead, letting the Desktop Environment handle the event.</p>
<p>It does it by checking if the Desktop Environment power manager
(in this case <code>mate-power-manager</code>) is running.  If it is, then
it will exit.</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/acpi-handler.patch"></script>

<h4 id="rtkit-spamming-logs">rtkit spamming logs</h4>
<p>Apparently, <code>rtkit</code> requres an <code>rtkit</code> user to exist.  Otherwise it
will spam the logs with error messages.  To correct use this command:</p>
<div class="highlight"><pre><span></span><code>useradd<span class="w"> </span>-r<span class="w"> </span>-s<span class="w"> </span>/sbin/nologin<span class="w"> </span>rtkit
</code></pre></div>

<h4 id="xen-tweaks">xen tweaks</h4>
<p>For xen we need to make some adjustments...</p>
<ol>
<li>Tweak block device references.</li>
<li><code>/etc/fstab</code> : mount xvda and other devices</li>
<li><code>/boot/cmdline</code> : get the right xvda root device</li>
<li>Enable disable services</li>
<li>Disable: <code>slim</code>, <code>agetty-ttyX</code></li>
<li>Enable: <code>agetty-hvc0</code></li>
<li>Decide if you want to use <code>NetworkManager</code> or <code>dhcpcd</code>.</li>
</ol>
<p>Normally, I would create a tarball image to transfer over, in order
for the image to work properly you need to save <code>capabilities</code>.</p>
<h3 id="old-notes">Old Notes</h3>
<h4 id="polkit-rule-tweaks">PolKit rule tweaks</h4>
<p>Testing as of 2019-09-07, the following does not seem to be needed
any longer.  I left it here just for reference (in case it breaks
again.</p>
<hr>
<p>OK, in my case, <code>shutdown</code>, <code>reboot</code> and local media access functions
were not available using the <a href="https://mate-desktop.org/" title="MATE Desktop environment">MATE</a> desktop.</p>
<p>To enable this I had to create/tweak the PolKit rules...</p>
<script src="https://tortugalabs.github.io/embed-like-gist/embed.js?style=github&showBorder=on&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on&target=https://github.com/alejandroliu/0ink.net/blob/master/snippets/void-installation/_attic_/tweak-polkit-rules.sh"></script>

<h3 id="using-slim">Using SLIM</h3>
<p>I have switched to <a href="https://github.com/iwamatsu/slim" title="Simple Login Manager">SLiM</a> as the display manager.  This is
configured in <code>/etc/slim.conf</code>.</p>
<p>Specifically, I update the login_cmd to be the following:</p>
<div class="highlight"><pre><span></span><code><span class="nv">login_cmd</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">sh</span><span class="w"> </span><span class="o">-</span><span class="nv">l</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">X11</span><span class="o">/</span><span class="nv">Xsession</span><span class="w"> </span><span class="o">%</span><span class="nv">session</span>
</code></pre></div>

<hr>

	</article>


		  </div>

		  <div class="sidebar">

	        <nav>
	          <h2>Years</h2>
	          <ul>
	              <li ><a href="/category/c2023.html">2023</a></li>
	              <li ><a href="/category/c2022.html">2022</a></li>
	              <li ><a href="/category/c2021.html">2021</a></li>
	              <li ><a href="/category/c2020.html">2020</a></li>
	              <li class="active"><a href="/category/c2019.html">2019</a></li>
	              <li ><a href="/category/c2018.html">2018</a></li>
	              <li ><a href="/category/c2017.html">2017</a></li>
	              <li ><a href="/category/c2016.html">2016</a></li>
	              <li ><a href="/category/c2015.html">2015</a></li>
	              <li ><a href="/category/c2014.html">2014</a></li>
	              <li ><a href="/category/c2013.html">2013</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/alejandroliu/">github</a><i></i></li>
				  <li><a href="https://www.linkedin.com/in/alejandro-liu-ly/">LinkedIn</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Links</h2>
	            <ul>
	                <li><a href="/sitemap.html">sitemap</a></li>
	                <li><a href="/tags.html">Tags</a></li>
	                <li><a href="https://github.com/alejandroliu/0ink.net">Repo</a></li>
	                <li><a href="https://home.0ink.net/nanowiki/">Wiki</a></li>
	            </ul>
	          </aside>
	      </div>

	  </div>

      <footer>

		<p role="contentinfo">
		  © 2021-2022 Alejandro Liu - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
		  <span class="feeds">
		    <a href="/feeds/rss.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="rss feed" title="rss feed"/></a>
		  </span>
		  </p>

	  </footer>

	</div>


</body>
</html>