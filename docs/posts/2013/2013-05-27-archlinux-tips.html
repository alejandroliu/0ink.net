<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>ArchLinux tips - 0ink.net</title>
	<meta name="author" content="Alejandro Liu">


	<meta name="description" content="A bunch of recipes useful for an ArchLinux system environment. Mostly around system administration. Custom Repos and Packages In the repo directory, put all the packages in there. repo-add ./custom.db.tar.gz ./* Add to pacman.conf: [custom] SigLevel = [Package|Databse]Never|Optional|Required Server = path-to-repo See also repo-remove. A …">
	<meta name="int-title" content="ArchLinux tips">
	<meta name="tags" content="boot, configuration, database, directory, installation, linux, network, settings, setup">
	<meta name="date" content="2013-05-27 00:00:00+02:00">
	<meta name="modified" content="2022-01-10 17:09:50+01:00">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />


    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="0ink.net Atom Feed" />
    <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="0ink.net RSS Feed" />
</head>

<body>
    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	        <a href="/feeds/atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed" title="atom feed"/></a>
	    </div>
		<nav class="pages">
			    <a href="/pages/about.html">About</a>
-			    <a href="/pages/privacy-policy.html">Privacy Policy</a>
		</nav>
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		0ink.net</a>
	      <div class="logo">
		<a href="/" class="title"
 title="Not the site you are looking for..."		>
		  <img src="/images/2021/0ink.png" width="44" height="44" />
		</a>
	      </div>



      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
			<iframe src="https://duckduckgo.com/search.html?site=0ink.net&prefill=Search with DuckDuckGo" style="overflow:hidden;margin:5px;padding:0;width:408px;height:40px;" frameborder="0"></iframe>

	<article class="full">

		<h1>ArchLinux tips</h1>

<div class="metadata">
  <time datetime="2013-05-27T00:00:00+02:00" pubdate>Mon 27 May 2013</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/alejandro-liu.html">Alejandro Liu</a>
    </address>
  <p>Updated: 2022-01-10 17:09:50+01:00</p>
  in <a href="/category/c2013.html">2013</a>
<p class="tags">tagged <a href="/tag/boot.html">boot</a>, <a href="/tag/configuration.html">configuration</a>, <a href="/tag/database.html">database</a>, <a href="/tag/directory.html">directory</a>, <a href="/tag/installation.html">installation</a>, <a href="/tag/linux.html">linux</a>, <a href="/tag/network.html">network</a>, <a href="/tag/settings.html">settings</a>, <a href="/tag/setup.html">setup</a></p></div>
		<p>A bunch of recipes useful for an ArchLinux system environment.</p>
<p>Mostly around system administration.</p>
<h2 id="custom-repos-and-packages">Custom Repos and Packages</h2>
<p>In the repo directory, put all the packages in there.</p>
<div class="highlight"><pre><span></span><code>repo-add ./custom.db.tar.gz ./*
</code></pre></div>

<p>Add to <code>pacman.conf</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[custom]</span><span class="w"></span>
<span class="na">SigLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[Package|Databse]Never|Optional|Required</span><span class="w"></span>
<span class="na">Server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">path-to-repo</span><span class="w"></span>
</code></pre></div>

<p>See also <code>repo-remove</code>. A package database is a tar file, optionally compressed. Valid extensions are <code>.db</code> or <code>.files</code> followed by an archive extension of <code>.tar</code>, <code>.tar.gz</code>, <code>.tar.bz2</code>, <code>.tar.xz</code>, or <code>.tar.Z</code>. The file does not need to exist, but all parent directories must exist. ?Can we create a <code>rpmgot.php</code> hack?</p>
<h2 id="safe-automatic-pacman-upgrades">Safe automatic pacman upgrades</h2>
<ul>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=66822">safepac</a> : This is an approach for automating pacman upgrades yet catching <em>problematic</em> updates before hand.</li>
</ul>
<h2 id="building-packages">Building packages</h2>
<p>requires: @base-devel, abs, fakeroot</p>
<div class="highlight"><pre><span></span><code>makepkg -s 
</code></pre></div>

<p>or</p>
<div class="highlight"><pre><span></span><code>makeworld ?
</code></pre></div>

<h2 id="working-with-the-serial-console">Working with the serial console</h2>
<p>Configure your Arch Linux machine so you can connect to it via the serial console port (com port). This will enable you to administer the machine even if it has no keyboard, mouse, monitor, or network attached to it (a headless server).</p>
<h3 id="configuration">Configuration</h3>
<p>Add this to the bootloader kernel line:</p>
<div class="highlight"><pre><span></span><code>console=tty0 console=ttyS0,9600
</code></pre></div>

<p>From systemd:</p>
<div class="highlight"><pre><span></span><code><span class="n">systemctl</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">getty</span><span class="nv">@ttyS0</span><span class="p">.</span><span class="n">service</span><span class="w"> </span>
</code></pre></div>

<h2 id="installing-arch-linux-using-the-serial-console">Installing Arch Linux using the serial console</h2>
<ol>
<li>Boot the target machine using the Arch Linux installation CD.</li>
<li>When the bootloader appears, select "Boot Arch Linux ()" and press tab to edit</li>
<li>Append console=ttyS0 and press enter</li>
<li>Systemd should now detect ttyS0 and spawn a serial getty on it, allowing you to proceed as usual</li>
</ol>
<p>Note: After setup is complete, the console settings will not be saved on the target machine; in order to avoid having to connect a keyboard and monitor, configure console access on the target machine before rebooting.</p>
<hr>
<h2 id="identifying-files-not-owned-by-any-package">Identifying files not owned by any package</h2>
<div class="highlight"><pre><span></span><code>pacman-disowned

#!/bin/sh

tmp=<span class="cp">${</span><span class="n">TMPDIR</span><span class="o">-/</span><span class="n">tmp</span><span class="cp">}</span>/pacman-disowned-<span class="nv">$UID</span>-$$
db=<span class="nv">$tmp</span>/db
fs=<span class="nv">$tmp</span>/fs

mkdir &quot;<span class="nv">$tmp</span>&quot;
trap &#39;rm -rf &quot;<span class="nv">$tmp</span>&quot;&#39; EXIT

pacman -Qlq | sort -u &gt; &quot;<span class="nv">$db</span>&quot;

find /bin /etc /sbin /usr 
  ! -name lost+found 
  ( -type d -printf &#39;%p/n&#39; -o -print ) | sort &gt; &quot;<span class="nv">$fs</span>&quot;

comm -23 &quot;<span class="nv">$fs</span>&quot; &quot;<span class="nv">$db</span>&quot;
</code></pre></div>

<h2 id="pacman-one-liners">Pacman one liners</h2>
<ul>
<li>
<p>Remove packages and its dependancies. pacman -Rs ...</p>
</li>
<li>
<p>List explicitly installed packages pacman -Qeq</p>
</li>
<li>
<p>List orphans pacman -Qtdq</p>
</li>
<li>
<p>Remove everything but base group pacman -Rs $(comm -23 &lt;(pacman -Qeq|sort) &lt;((for i in $(pacman -Qqg base); do pactree -ul $i; done)|sort -u|cut -d ' ' -f 1))</p>
</li>
<li>
<p>Listing changed configuraiton files pacman -Qii | awk '/^MODIFIED/ {print $2}'</p>
</li>
<li>
<p>Download a package without installing it pacman -Sw package_name</p>
</li>
<li>
<p>Manage pacman cache</p>
<p>paccache -h</p>
</li>
</ul>

	</article>


		  </div>

		  <div class="sidebar">

	        <nav>
	          <h2>Years</h2>
	          <ul>
	              <li ><a href="/category/c2022.html">2022</a></li>
	              <li ><a href="/category/c2021.html">2021</a></li>
	              <li ><a href="/category/c2020.html">2020</a></li>
	              <li ><a href="/category/c2019.html">2019</a></li>
	              <li ><a href="/category/c2018.html">2018</a></li>
	              <li ><a href="/category/c2017.html">2017</a></li>
	              <li ><a href="/category/c2016.html">2016</a></li>
	              <li ><a href="/category/c2015.html">2015</a></li>
	              <li ><a href="/category/c2014.html">2014</a></li>
	              <li class="active"><a href="/category/c2013.html">2013</a></li>
	              <li ><a href="/category/c.html">...</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/alejandroliu/">github</a><i></i></li>
				  <li><a href="https://www.linkedin.com/in/alejandro-liu-ly/">LinkedIn</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Links</h2>
	            <ul>
	                <li><a href="https://github.com/alejandroliu/0ink.net">Repo</a></li>
	                <li><a href="https://alejandro.iliu.net/">Alejandro</a></li>
	                <li><a href="/tags.html">Tags</a></li>
	                <li><a href="/sitemap.html">sitemap</a></li>
	            </ul>
	          </aside>
	      </div>

	  </div>

      <footer>

		<p role="contentinfo">
		  © 2021 Alejandro Liu - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
		  <span class="feeds">
		    <a href="/feeds/rss.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="rss feed" title="rss feed"/></a>
		  </span>
		  </p>

	  </footer>

	</div>


</body>
</html>